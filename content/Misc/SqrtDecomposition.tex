\documentclass[main.tex]{subfiles}
\begin{document}

\chapter{根號算法}
\section{前言}
	「十則圍之、五則攻之、倍則分之」，這是孫子兵法中提到的，說要視面對敵人的多寡，要採用不同的策略。同樣地，如果題目給的範圍有不同的限制，可能需要不同的作法。有時，這個限制可可能會在題目中就給了；不過，有時候題目連這個都不會給！所以，就必須要自己來界定分離的標準了。這個方法有時候看起來很通靈，甚至很唬爛，但是經過分析之後是對的，時常能將複雜度的一個變數降為其根號，譬如一個$O(N^2)$的演算法其實經過一點巧思是$O(N\sqrt{N})$，雖然會比$\log$等級的演算法慢一些，但是通常實作複雜度低許多，是一個很實用的工具！

\section{種類壓大小}
	還是一樣，先看一個簡單的例題吧：
	\problem{詭異的詢問（No Judge）}{
		我有一個神秘函數$f(x)$。每次，你都可以詢問一個$x$，我就會回你$f(x)$的值。另外一個人會問你$Q \leq 10^6$個正整數$k_i$，代表你要回答說$f(k)$等於多少，而且保證$\sum^{Q - 1}_{i = 0} k_i \leq 10^8$。然而，我很不耐煩，所以你只能問我$1000$次的詢問。請好好利用這$15000$次的詢問，來回答另外一個人的$10^6$個詢問吧！
	}

	乍看之下，這題根本不可做——有$10^6$筆詢問，可能有$10^8$個不同的數字，而我只有$10^4$次的詢問，根本不可做！首先，會先想到說如果重複詢問的話，那就先把問過的東西存下來再回答就好啦！所以呢，現在的問題就變成：到底有多少個可能的詢問呢？不過，或許眼尖的你注意到了奇怪的限制：$\sum^{Q - 1}_{i = 0} k_i \leq 10^8$！這有什麼用呢？想要讓數字最多種，當然要讓詢問的數字越小越好，才比較不會超越所給的限制，才會有最多種的數字呀！所以，假設是有$n$種數字，則一定是依序詢問$1, 2, 3, \dots, n$才好，所以呢：
	\begin{align*}
		\frac{n(n + 1)}{2} &\leq 10^8\\	
		(n + 1)^2 &\leq 2 \times 10^8\\
		n &\leq \sqrt{2 \times 10^8} - 1 \approx 14141 < 15000
	\end{align*}
	也就是呢，最多有$14141$種相異個數字會出現，所以只要存下來就好了！運用這個技巧，可以推論出一個結論：
	\theorem{和與種類的不等式}{
		假設有一堆數字的和為$S$，則那些數字的種類數量的數量級為$O(\sqrt{S})$。
	}
	此定理的證明和上面是一樣的，這裏就不贅述了。

\section{不會有那麼多個吧！}
	在一個圖中尋找三角形是很經典的一個問題：
	\problem{尋找三角形（經典問題）}{
		給定一個有$N \leq 10^4$個點，$M \leq 10^4$個邊的圖，請問這個圖有幾個三角形？一個三角形的定義為一個無序的3-tuple $(u, v, w)$（$1 \leq u, v, w \leq N$），使得那三個點兩兩有邊連接。
	}
	先直接丟唬爛的解：枚舉一個邊$(u, v)$，看$\text{deg}(u)$和$\text{deg}(v)$哪一個比較小（假設是$u$），那就直接硬枚舉所有與$u$連結的點$x$，並看$x$和$v$是否有沒有連結，如果有的話，就直接加一。這樣，每個三角形都會被數到三次，所以就輸出答案除以三就好了！這樣的複雜度是$O(NM)$，因為對於每一個邊，都有可能掃到每另外一個邊。所以呢，先寫看看，傳上去，可以拿個部分——什麼？！居然AC了？為什麼呀？一樣用根號算法中的分case方法來分析其複雜度。接下來我們稱度數小於$\sqrt{M}$的點作「輕點」，反之則稱為「重點」。接下來考慮每個點當「小點」（一條邊連接的兩個點中度數較小的那個）對複雜度的貢獻。首先如果是輕點當小點，那就太棒了！因為輕點的度數小於$\sqrt{M}$，因此輕點當小點的狀況總共為複雜度貢獻了$N sqrt{M}$。接下來如果是重點當小點的話，考慮一個大小為$k$重點當輕點的次數，因為總度數是$2M$，所以它當小點的次數最多只有$\frac{2M}{k}$那麼多次，而每次他當小點對答案的貢獻最多就是$k \cdot \frac{2M}{k} = 2M$。因此每個重點當小點對答案的貢獻就是$2M$，而重點又不超過$O(\sqrt{M})$個，所以這部分對總複雜度的貢獻就是$O(M\sqrt{M})$。因此這整個做法的複雜度就是$O((N+M)M\sqrt{M})$。

	\end{document}
